<!DOCTYPE html>
<html>
  <head>
    <title>MiCRO 23</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />

    <script>
      function mostrarFormulario() {
        const form = document.getElementById("formCadastro");
        form.classList.add("show");
        document.getElementById("mostrarCadastro").style.display = "none";
      }

      function cancelarFormulario() {
        const form = document.getElementById("formCadastro");
        form.reset();
        form.classList.remove("show");
        document.getElementById("mostrarCadastro").style.display =
          "inline-block";
      }

      document.addEventListener("DOMContentLoaded", function () {
        const form = document.getElementById("formCadastro");

        form.addEventListener("submit", function (e) {
          setTimeout(() => {
            form.reset();
            form.classList.remove("show");
            document.getElementById("mostrarCadastro").style.display =
              "inline-block";
          }, 500);
        });
      });
    </script>
  </head>
  <body>
    <h1>Gerenciar Pessoas na Planilha</h1>

    <!-- Formulário de pesquisa -->
    <form action="{{ url_for('main.index') }}" method="GET" class="search-form">
      <label for="query">Buscar por Nome, SUS ou CPF:</label>
      <input type="text" name="query" />
      <button type="submit">Pesquisar</button>
    </form>

    <!-- Botão para exibir formulário -->
    <button id="mostrarCadastro" onclick="mostrarFormulario()">
      Cadastrar nova pessoa
    </button>

    <!-- Formulário de cadastro (inicialmente oculto com animação) -->
    <form
      id="formCadastro"
      action="{{ url_for('main.manage_person') }}"
      method="POST"
      class="data-form"
    >
      {% for chave in dados[0].keys() %}
      <label for="{{ chave }}">{{ chave }}:</label>
      <input type="text" name="{{ chave }}" required />
      {% endfor %}
      <button type="submit">Salvar</button>
      <button
        type="button"
        onclick="cancelarFormulario()"
        style="background-color: #dc3545; margin-top: 10px"
      >
        Cancelar
      </button>
    </form>

    <!-- Tabela de dados -->
    {% if dados and dados|length > 0 %}
    <table>
      <thead>
        <tr>
          {% for chave in dados[0].keys() %}
          <th>{{ chave }}</th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for linha in dados %}
        <tr>
          {% for valor in linha.values() %}
          <td>{{ valor }}</td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p>Nenhum dado encontrado na planilha.</p>
    {% endif %}
  </body>
</html>
